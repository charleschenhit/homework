<!--pages/analysis/analysis.wxml-->
<view class="container">
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <image class="loading-icon" src="/images/loading.gif"></image>
    <text class="loading-text">正在解析题目...</text>
  </view>

  <!-- 错误状态 -->
  <view class="error" wx:elif="{{error}}">
    <image class="error-icon" src="/images/error.png"></image>
    <text class="error-text">{{error}}</text>
    <button class="btn-primary" bindtap="loadProblemData" data-problem-id="{{problemId}}">重试</button>
  </view>

  <!-- 题目解析内容 -->
  <view class="analysis-content" wx:else>
    <!-- 题目图片 -->
    <view class="problem-image-section">
      <image class="problem-image" src="{{problemData.imageUrl}}" mode="aspectFit"></image>
      <view class="image-actions">
        <button class="btn-secondary" bindtap="editOcrText">编辑文本</button>
      </view>
    </view>

    <!-- OCR识别文本 -->
    <view class="ocr-section card">
      <view class="section-header">
        <text class="section-title">题目内容</text>
      </view>
      <view class="ocr-text">{{problemData.ocrText}}</view>
    </view>

    <!-- AI解析结果 -->
    <view class="analysis-section card">
      <view class="section-header">
        <text class="section-title">AI解析</text>
        <button class="btn-secondary" bindtap="regenerateAnalysis">换一种讲法</button>
      </view>
      
      <!-- 答案 -->
      <view class="answer-section">
        <text class="answer-label">答案：</text>
        <text class="answer-content">{{problemData.answer}}</text>
      </view>

      <!-- 解题步骤 -->
      <view class="steps-section">
        <text class="steps-label">解题步骤：</text>
        <view class="steps-list">
          <view class="step-item" wx:for="{{problemData.steps}}" wx:key="index">
            <text class="step-number">{{index + 1}}.</text>
            <text class="step-content">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- 知识点 -->
      <view class="knowledge-section">
        <text class="knowledge-label">知识点：</text>
        <view class="knowledge-tags">
          <text class="knowledge-tag" wx:for="{{problemData.knowledgePoints}}" wx:key="index">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button class="action-btn audio-btn {{isPlayingAudio ? 'playing' : ''}}" bindtap="playAudio">
        <image class="btn-icon" src="/images/{{isPlayingAudio ? 'pause' : 'play'}}.png"></image>
        <text class="btn-text">{{isPlayingAudio ? '停止播放' : '语音讲解'}}</text>
      </button>
      
      <button class="action-btn chat-btn" bindtap="goToChat">
        <image class="btn-icon" src="/images/chat.png"></image>
        <text class="btn-text">对话问答</text>
      </button>
      
      <button class="action-btn mistake-btn" bindtap="addToMistakeBook">
        <image class="btn-icon" src="/images/mistake.png"></image>
        <text class="btn-text">加入错题本</text>
      </button>
    </view>
  </view>
</view>
